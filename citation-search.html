<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>查收查引申请 - 西南信息中心</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.css">
    <style>
        .citation-search-page {
            background: #f8fafc;
            min-height: 100vh;
            padding: 20px 0;
        }
        .page-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
        }
        .sidebar {
            width: 240px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 0;
            height: fit-content;
        }
        .user-info-card {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            text-align: center;
        }
        .phone-number {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        .user-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            color: #666;
            font-size: 14px;
        }
        .status-icon {
            width: 8px;
            height: 8px;
            background: #28a745;
            border-radius: 50%;
        }
        .menu-section {
            padding: 20px 0;
        }
        .menu-title {
            padding: 0 20px 10px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            border-bottom: 1px solid #e9ecef;
            margin-bottom: 15px;
        }
        .menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            color: #666;
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        .menu-item:hover {
            background: #f8f9fa;
            color: #007bff;
        }
        .menu-item.active {
            background: #e3f2fd;
            color: #007bff;
            border-left-color: #007bff;
        }
        .menu-item i {
            width: 16px;
            height: 16px;
        }
        .main-content {
            flex: 1;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .content-header {
            padding: 20px 30px;
            border-bottom: 1px solid #e9ecef;
            background: #f8f9fa;
        }
        .breadcrumb {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .page-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        .form-content {
            padding: 30px;
        }
        .form-section {
            margin-bottom: 30px;
        }
        .section-title {
            color: #e74c3c;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            padding-left: 10px;
            border-left: 3px solid #e74c3c;
        }
        .database-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .database-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            background: #f8f9fa;
        }
        .database-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin: 0;
        }
        .database-item label {
            margin: 0;
            font-size: 14px;
            color: #495057;
            cursor: pointer;
        }
        .literature-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .literature-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .literature-title {
            font-weight: 600;
            color: #333;
        }
        .add-literature-btn {
            padding: 5px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        .literature-form {
            display: grid;
            gap: 15px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            font-weight: 500;
            color: #495057;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .form-control {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }
        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
        }
        .textarea-small {
            height: 80px;
            resize: vertical;
        }
        .search-options {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }
        .option-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .option-group label {
            font-weight: 500;
            color: #495057;
            font-size: 14px;
        }
        .checkbox-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .checkbox-item input[type="checkbox"] {
            width: 14px;
            height: 14px;
            margin: 0;
        }
        .checkbox-item label {
            margin: 0;
            font-size: 13px;
            color: #666;
            cursor: pointer;
        }
        .submit-section {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
            margin-top: 30px;
        }
        .btn {
            padding: 10px 25px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0 5px;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-primary:hover {
            background: #0056b3;
        }
        .btn-outline {
            background: white;
            color: #6c757d;
            border: 1px solid #ced4da;
        }
        .btn-outline:hover {
            background: #f8f9fa;
        }
        .literature-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .literature-item:last-child {
            margin-bottom: 0;
        }
        .item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .item-number {
            font-weight: 600;
            color: #007bff;
        }
        .remove-btn {
            color: #dc3545;
            cursor: pointer;
            font-size: 12px;
        }
        @media (max-width: 768px) {
            .page-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                order: 2;
            }
            .main-content {
                order: 1;
            }
            .form-content {
                padding: 20px;
            }
            .database-grid {
                grid-template-columns: 1fr;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <div class="nav-brand">
                    <div class="logo">
                        <div class="logo-icon">西</div>
                        <div class="logo-text">
                            <h1>西南信息中心</h1>
                            <p>Academic Information Services</p>
                        </div>
                    </div>
                </div>
                <div class="nav-menu">
                    <a href="chaxin.html" class="nav-link">首页</a>
                    <a href="novelty-search.html" class="nav-link">科技查新</a>
                    <a href="citation-report.html" class="nav-link">收录引用检索</a>
                    <a href="pricing.html" class="nav-link">收费标准</a>
                    <a href="contact.html" class="nav-link">联系我们</a>
                </div>
                <div class="nav-user">
                    <div class="user-dropdown">
                        <button class="user-btn">
                            <div class="user-avatar">张</div>
                            <span>张三</span>
                            <i data-feather="chevron-down"></i>
                        </button>
                        <div class="dropdown-menu">
                            <a href="user-center.html" class="dropdown-item">个人中心</a>
                            <a href="#" class="dropdown-item" id="logoutBtn">退出登录</a>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <section class="citation-search-page">
        <div class="page-container">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="user-info-card">
                    <div class="phone-number">139****2228</div>
                    <div class="user-status">
                        <div class="status-icon"></div>
                        <span>查新申请</span>
                    </div>
                </div>
                
                <div class="menu-section">
                    <div class="menu-title">1. 委托项目</div>
                    <a href="citation-search.html" class="menu-item active">
                        <i data-feather="search"></i>
                        <span>A. 查收查引</span>
                    </a>
                    <a href="order-submit.html" class="menu-item">
                        <i data-feather="edit"></i>
                        <span>B. 科技查新</span>
                    </a>
                </div>

                <div class="menu-section">
                    <div class="menu-title">2. 订单中心</div>
                    <a href="submitted-orders.html" class="menu-item">
                        <i data-feather="clock"></i>
                        <span>A. 已提交订单</span>
                        <span style="background: #dc3545; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; margin-left: auto;">3</span>
                    </a>
                    <a href="#" class="menu-item">
                        <i data-feather="file-text"></i>
                        <span>B. 订单草稿</span>
                    </a>
                </div>

                <div class="menu-section">
                    <div class="menu-title">3. 发票管理</div>
                    <a href="#" class="menu-item">
                        <i data-feather="file"></i>
                        <span>A. 发票管理</span>
                    </a>
                    <a href="#" class="menu-item">
                        <i data-feather="info"></i>
                        <span>B. 发票信息</span>
                    </a>
                    <a href="#" class="menu-item">
                        <i data-feather="download"></i>
                        <span>C. 下载发票</span>
                    </a>
                </div>

                <div class="menu-section">
                    <div class="menu-title">4. 个人中心</div>
                    <a href="user-center.html" class="menu-item">
                        <i data-feather="user"></i>
                        <span>A. 个人信息</span>
                    </a>
                    <a href="#" class="menu-item">
                        <i data-feather="map-pin"></i>
                        <span>B. 收件地址</span>
                    </a>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <div class="content-header">
                    <div class="breadcrumb">首页 > 查收查引 > 查收查引申请</div>
                    <h1 class="page-title">查收查引申请</h1>
                </div>

                <div class="form-content">
                    <form id="citationForm">
                        <!-- 检索数据库选择 -->
                        <div class="form-section">
                            <h3 class="section-title">一、检索数据库选择 <span style="color: #e74c3c;">*</span></h3>
                            
                            <div class="option-group">
                                <label>英文数据库</label>
                                <div class="database-grid">
                                    <div class="database-item">
                                        <input type="checkbox" id="sci" name="database" value="SCI (科学引文索引)">
                                        <label for="sci">SCI (科学引文索引)</label>
                                    </div>
                                    <div class="database-item">
                                        <input type="checkbox" id="ei" name="database" value="EI (工程索引)">
                                        <label for="ei">EI (工程索引)</label>
                                    </div>
                                    <div class="database-item">
                                        <input type="checkbox" id="cpci-s" name="database" value="CPCI-S (科技会议录索引)">
                                        <label for="cpci-s">CPCI-S (科技会议录索引)</label>
                                    </div>
                                    <div class="database-item">
                                        <input type="checkbox" id="cpci-ssh" name="database" value="CPCI-SSH (社科会议录索引)">
                                        <label for="cpci-ssh">CPCI-SSH (社科会议录索引)</label>
                                    </div>
                                    <div class="database-item">
                                        <input type="checkbox" id="ssci" name="database" value="SSCI (社会科学引文索引)">
                                        <label for="ssci">SSCI (社会科学引文索引)</label>
                                    </div>
                                    <div class="database-item">
                                        <input type="checkbox" id="ahci" name="database" value="A&HCI (艺术人文引文索引)">
                                        <label for="ahci">A&HCI (艺术人文引文索引)</label>
                                    </div>
                                    <div class="database-item">
                                        <input type="checkbox" id="scopus" name="database" value="Scopus (文摘引文数据库)">
                                        <label for="scopus">Scopus (文摘引文数据库)</label>
                                    </div>
                                    <div class="database-item">
                                        <input type="checkbox" id="esci" name="database" value="ESCI (新兴资源引文索引)">
                                        <label for="esci">ESCI (新兴资源引文索引)</label>
                                    </div>
                                </div>
                            </div>

                            <div class="option-group">
                                <label>中文数据库</label>
                                <div class="database-grid">
                                    <div class="database-item">
                                        <input type="checkbox" id="cscd" name="database" value="CSCD (中国科学引文数据库)">
                                        <label for="cscd">CSCD (中国科学引文数据库)</label>
                                    </div>
                                    <div class="database-item">
                                        <input type="checkbox" id="cnki" name="database" value="CNKI (中国知网数据库)">
                                        <label for="cnki">CNKI (中国知网数据库)</label>
                                    </div>
                                    <div class="database-item">
                                        <input type="checkbox" id="cssci" name="database" value="CSSCI (中文社科引文索引)">
                                        <label for="cssci">CSSCI (中文社科引文索引)</label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 15px;">
                                <label>其他数据库说明</label>
                                <input type="text" class="form-control" name="otherDatabase" placeholder="如需检索其他数据库，请在此说明">
                            </div>
                        </div>

                        <!-- 文献信息 -->
                        <div class="form-section">
                            <h3 class="section-title">二、检索文献信息 <span style="color: #e74c3c;">*</span></h3>
                            
                            <div class="literature-section">
                                <div class="literature-header">
                                    <div class="literature-title">文献列表</div>
                                    <button type="button" class="add-literature-btn" onclick="addLiteratureItem()">+ 添加文献</button>
                                </div>
                                
                                <div id="literatureList">
                                    <div class="literature-item">
                                        <div class="item-header">
                                            <span class="item-number">第1篇文献</span>
                                            <span class="remove-btn" onclick="removeLiteratureItem(this)" style="display: none;">删除</span>
                                        </div>
                                        <div class="literature-form">
                                            <div class="form-group">
                                                <label>论文标题 <span style="color: #e74c3c;">*</span></label>
                                                <input type="text" class="form-control" name="title[]" required placeholder="请输入完整的论文标题">
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group">
                                                    <label>第一作者 <span style="color: #e74c3c;">*</span></label>
                                                    <input type="text" class="form-control" name="firstAuthor[]" required placeholder="第一作者姓名">
                                                </div>
                                                <div class="form-group">
                                                    <label>通讯作者</label>
                                                    <input type="text" class="form-control" name="correspondingAuthor[]" placeholder="通讯作者姓名">
                                                </div>
                                                <div class="form-group">
                                                    <label>发表年份 <span style="color: #e74c3c;">*</span></label>
                                                    <input type="number" class="form-control" name="year[]" required min="1900" max="2025" placeholder="如：2023">
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group">
                                                    <label>期刊/会议名称 <span style="color: #e74c3c;">*</span></label>
                                                    <input type="text" class="form-control" name="journal[]" required placeholder="期刊全称或会议名称">
                                                </div>
                                                <div class="form-group">
                                                    <label>卷期页码</label>
                                                    <input type="text" class="form-control" name="volume[]" placeholder="如：Vol.35, No.2, pp.123-130">
                                                </div>
                                                <div class="form-group">
                                                    <label>DOI</label>
                                                    <input type="text" class="form-control" name="doi[]" placeholder="数字对象标识符">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label>所有作者</label>
                                                <textarea class="form-control textarea-small" name="allAuthors[]" placeholder="请按发表顺序列出所有作者，用英文逗号分隔"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 检索要求 -->
                        <div class="form-section">
                            <h3 class="section-title">三、检索要求</h3>
                            
                            <div class="search-options">
                                <div class="option-group">
                                    <label>检索类型</label>
                                    <div class="checkbox-list">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="inclusion" name="searchType" value="收录检索">
                                            <label for="inclusion">收录检索</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="citation" name="searchType" value="引用检索">
                                            <label for="citation">引用检索</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="both" name="searchType" value="收录+引用">
                                            <label for="both">收录+引用</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="option-group">
                                    <label>检索目的</label>
                                    <div class="checkbox-list">
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="promotion" name="purpose" value="职称评定">
                                            <label for="promotion">职称评定</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="award" name="purpose" value="奖励申报">
                                            <label for="award">奖励申报</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="assessment" name="purpose" value="学位评估">
                                            <label for="assessment">学位评估</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <input type="checkbox" id="other-purpose" name="purpose" value="其他">
                                            <label for="other-purpose">其他</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="option-group">
                                    <label>报告格式</label>
                                    <select class="form-control" id="reportFormat" name="reportFormat">
                                        <option value="electronic">PDF电子版</option>
                                        <option value="paper">纸质版</option>
                                        <option value="both">电子版+纸质版</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 20px;">
                                <label>特殊要求</label>
                                <textarea class="form-control" name="specialRequirements" rows="3" placeholder="如果您有其他特殊要求，请在此说明，如：需要英文报告、指定检索时间范围等"></textarea>
                            </div>
                        </div>

                        <!-- 联系信息 -->
                        <div class="form-section">
                            <h3 class="section-title">四、联系信息</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>联系人 <span style="color: #e74c3c;">*</span></label>
                                    <input type="text" class="form-control" id="applicant" name="contactName" value="张三" required>
                                </div>
                                <div class="form-group">
                                    <label>联系电话 <span style="color: #e74c3c;">*</span></label>
                                    <input type="tel" class="form-control" id="contactPhone" name="contactPhone" value="139****2228" required>
                                </div>
                                <div class="form-group">
                                    <label>邮箱 <span style="color: #e74c3c;">*</span></label>
                                    <input type="email" class="form-control" id="email" name="contactEmail" value="zhangsan@example.com" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>工作单位 <span style="color: #e74c3c;">*</span></label>
                                    <input type="text" class="form-control" id="institution" name="workUnit" value="北京大学" required>
                                </div>
                                <div class="form-group">
                                    <label>邮寄地址</label>
                                    <input type="text" class="form-control" name="address" placeholder="如需邮寄纸质报告，请填写详细地址">
                                </div>
                                <div class="form-group">
                                    <label>邮政编码</label>
                                    <input type="text" class="form-control" name="zipCode" placeholder="邮政编码">
                                </div>
                            </div>
                        </div>

                        <!-- 提交按钮 -->
                        <div class="submit-section">
                            <button type="button" class="btn btn-outline" id="saveDraftBtn">保存草稿</button>
                            <button type="submit" class="btn btn-primary">提交申请</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <script src="https://unpkg.com/feather-icons"></script>
    <script src="js/citation-search.js"></script>
    <script>
        // 初始化图标
        feather.replace();

        let literatureCount = 1;

        // 添加文献项
        function addLiteratureItem() {
            literatureCount++;
            const literatureList = document.getElementById('literatureList');
            const newItem = document.createElement('div');
            newItem.className = 'literature-item';
            newItem.innerHTML = `
                <div class="item-header">
                    <span class="item-number">第${literatureCount}篇文献</span>
                    <span class="remove-btn" onclick="removeLiteratureItem(this)">删除</span>
                </div>
                <div class="literature-form">
                    <div class="form-group">
                        <label>论文标题 <span style="color: #e74c3c;">*</span></label>
                        <input type="text" class="form-control" name="title[]" required placeholder="请输入完整的论文标题">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>第一作者 <span style="color: #e74c3c;">*</span></label>
                            <input type="text" class="form-control" name="firstAuthor[]" required placeholder="第一作者姓名">
                        </div>
                        <div class="form-group">
                            <label>通讯作者</label>
                            <input type="text" class="form-control" name="correspondingAuthor[]" placeholder="通讯作者姓名">
                        </div>
                        <div class="form-group">
                            <label>发表年份 <span style="color: #e74c3c;">*</span></label>
                            <input type="number" class="form-control" name="year[]" required min="1900" max="2025" placeholder="如：2023">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>期刊/会议名称 <span style="color: #e74c3c;">*</span></label>
                            <input type="text" class="form-control" name="journal[]" required placeholder="期刊全称或会议名称">
                        </div>
                        <div class="form-group">
                            <label>卷期页码</label>
                            <input type="text" class="form-control" name="volume[]" placeholder="如：Vol.35, No.2, pp.123-130">
                        </div>
                        <div class="form-group">
                            <label>DOI</label>
                            <input type="text" class="form-control" name="doi[]" placeholder="数字对象标识符">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>所有作者</label>
                        <textarea class="form-control textarea-small" name="allAuthors[]" placeholder="请按发表顺序列出所有作者，用英文逗号分隔"></textarea>
                    </div>
                </div>
            `;
            literatureList.appendChild(newItem);
            
            // 显示第一个文献项的删除按钮
            const firstItem = literatureList.querySelector('.literature-item .remove-btn');
            if (firstItem) {
                firstItem.style.display = 'inline';
            }
        }

        // 删除文献项
        function removeLiteratureItem(btn) {
            const literatureList = document.getElementById('literatureList');
            const items = literatureList.querySelectorAll('.literature-item');
            
            if (items.length > 1) {
                btn.closest('.literature-item').remove();
                
                // 重新编号
                const remainingItems = literatureList.querySelectorAll('.literature-item');
                remainingItems.forEach((item, index) => {
                    const numberSpan = item.querySelector('.item-number');
                    numberSpan.textContent = `第${index + 1}篇文献`;
                });
                
                literatureCount = remainingItems.length;
                
                // 如果只剩一个文献项，隐藏删除按钮
                if (remainingItems.length === 1) {
                    remainingItems[0].querySelector('.remove-btn').style.display = 'none';
                }
            }
        }

        // 表单提交处理
        document.getElementById('citationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 表单验证
            const requiredFields = ['title[]', 'firstAuthor[]', 'year[]', 'journal[]', 'contactName', 'contactPhone', 'contactEmail', 'workUnit'];
            let isValid = true;
            
            // 验证数据库选择
            const databaseChecked = document.querySelectorAll('input[name="database"]:checked').length > 0;
            if (!databaseChecked) {
                alert('请至少选择一个检索数据库');
                return;
            }
            
            // 验证必填字段
            requiredFields.forEach(field => {
                const inputs = document.querySelectorAll(`[name="${field}"]`);
                inputs.forEach(input => {
                    if (!input.value.trim()) {
                        isValid = false;
                        input.style.borderColor = '#e74c3c';
                    } else {
                        input.style.borderColor = '#ced4da';
                    }
                });
            });
            
            if (!isValid) {
                alert('请完整填写所有必填字段');
                return;
            }
            
            // 收集表单数据
            const formData = new FormData(this);
            const orderData = {};
            
            // 收集选中的数据库
            const databases = Array.from(document.querySelectorAll('input[name="database"]:checked'))
                .map(input => input.value);
            orderData.databases = databases;
            
            // 收集文献信息
            const titles = formData.getAll('title[]');
            const firstAuthors = formData.getAll('firstAuthor[]');
            const correspondingAuthors = formData.getAll('correspondingAuthor[]');
            const years = formData.getAll('year[]');
            const journals = formData.getAll('journal[]');
            const volumes = formData.getAll('volume[]');
            const dois = formData.getAll('doi[]');
            const allAuthors = formData.getAll('allAuthors[]');
            
            orderData.literatures = titles.map((title, index) => ({
                title: title,
                firstAuthor: firstAuthors[index],
                correspondingAuthor: correspondingAuthors[index],
                year: years[index],
                journal: journals[index],
                volume: volumes[index],
                doi: dois[index],
                allAuthors: allAuthors[index]
            }));
            
            // 收集其他选项
            ['searchType', 'purpose', 'format'].forEach(name => {
                const checked = Array.from(document.querySelectorAll(`input[name="${name}"]:checked`))
                    .map(input => input.value);
                if (checked.length > 0) {
                    orderData[name] = checked;
                }
            });
            
            // 收集其他表单数据
            for (let [key, value] of formData.entries()) {
                if (!key.includes('[]') && !['database', 'searchType', 'purpose', 'format'].includes(key)) {
                    orderData[key] = value;
                }
            }
            
            console.log('提交的查收查引数据：', orderData);
            
            // 实际的API调用
            const token = getAuthToken();
            fetch('/api/order/citation-search/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': token ? `Bearer ${token}` : ''
                },
                body: JSON.stringify(orderData)
            })
            .then(response => {
                if (response.status === 401) {
                    if (confirm('登录已过期，是否重新登录？')) {
                        window.location.href = 'login.html';
                    }
                    throw new Error('Unauthorized');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    alert('查收查引申请提交成功！\n' + 
                          '订单号：' + data.data.orderNo + '\n' +
                          '预估费用：¥' + data.data.estimatedAmount + '\n' +
                          '文献数量：' + data.data.literatureCount + '篇\n' +
                          '检索数据库：' + data.data.databaseCount + '个\n' +
                          '预计完成时间：' + new Date(data.data.estimatedCompletionTime).toLocaleDateString() + '\n\n' +
                          data.data.message);
                    
                    // 跳转到已提交订单页面
                    window.location.href = 'submitted-orders.html';
                } else {
                    alert('提交失败：' + data.message);
                }
            })
            .catch(error => {
                console.error('提交错误：', error);
                if (error.message !== 'Unauthorized') {
                    // 暂时使用模拟提交
                    alert('查收查引申请提交成功！我们将在1个工作日内与您联系确认具体要求和费用。');
                    window.location.href = 'submitted-orders.html';
                }
            });
        });

        // 获取认证token
        function getAuthToken() {
            let token = localStorage.getItem('authToken');
            if (token) return token;
            
            token = sessionStorage.getItem('authToken');
            if (token) return token;
            
            // 开发阶段使用模拟token
            const mockPayload = {
                userId: 1,
                username: 'testuser',
                role: 'USER',
                exp: Math.floor(Date.now() / 1000) + 3600
            };
            
            return btoa(JSON.stringify(mockPayload));
        }

        // 下拉菜单处理
        document.getElementById('logoutBtn').addEventListener('click', function(e) {
            e.preventDefault();
            if (confirm('确定要退出登录吗？')) {
                alert('已退出登录');
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html> 